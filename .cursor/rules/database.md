# 데이터베이스 직접 작업 규칙 (MCP 우선)

## 핵심 원칙
**데이터베이스 관련 작업 요청 시, 스크립트나 코드를 생성하지 말고 MCP를 통해 직접 데이터베이스에 연결하여 작업을 수행한다.**

## 작업 방식

### 1. DB 작업 요청 처리 방식
- ✅ **MCP 직접 연결**: Supabase MCP를 통해 즉시 DB 작업 실행
- ❌ **스크립트 생성 금지**: SQL 파일이나 실행 스크립트 생성하지 않음
- ❌ **코드 생성 금지**: 데이터베이스 작업용 코드 생성하지 않음

### 2. MCP 사용 우선순위
1. **1순위**: Supabase MCP 직접 연결
2. **2순위**: MCP 연결 실패 시에만 대안 제시
3. **3순위**: 스크립트 생성은 최후 수단

### 3. 작업 수행 방식

#### **데이터 조회 요청 시**

사용자: "학생 테이블의 모든 데이터를 보여줘"
→ MCP로 직접 연결하여 "SELECT * FROM students LIMIT 100" 실행
→ 결과를 바로 표시

#### **데이터 삽입 요청 시**
사용자: "새 학생을 추가해줘"
→ MCP로 직접 연결하여 INSERT 쿼리 실행
→ 실행 결과와 생성된 ID 반환

#### **데이터 수정 요청 시**

사용자: "김철수 학생의 학년을 고2로 변경해줘"
→ MCP로 직접 연결하여 UPDATE 쿼리 실행
→ 수정된 행 수와 결과 반환

#### **데이터 삭제 요청 시**

사용자: "ID가 123인 학생을 삭제해줘"
→ MCP로 직접 연결하여 DELETE 쿼리 실행
→ 삭제된 행 수와 결과 반환

### 4. 작업 전 확인사항
- **스키마 확인**: 작업 전 관련 테이블 스키마 먼저 조회
- **데이터 검증**: 입력 데이터 유효성 검사
- **권한 확인**: RLS 정책 및 접근 권한 확인
- **안전성 검증**: WHERE 절 누락 방지

### 5. 응답 형식

#### **성공 시**

✅ 작업 완료
실행된 쿼리: [쿼리 내용]
영향받은 행: [행 수]

#### **실패 시**

❌ 작업 실패
오류 유형: [오류 종류]
오류 메시지: [상세 메시지]

### 6. 특별 규칙

#### **스키마 조회**
- 테이블 구조, 인덱스, 제약조건 등은 MCP로 직접 조회
- 스키마 정보를 파일로 저장하지 않음

#### **통계 및 분석**
- COUNT, SUM, AVG 등 집계 쿼리 직접 실행
- 결과를 차트나 표로 바로 표시

#### **데이터 백업**
- 중요한 데이터 변경 전 자동으로 백업 쿼리 실행
- 백업 결과를 즉시 확인 가능하도록 표시

### 7. 금지 사항

#### **절대 금지**
- ❌ SQL 파일 생성 (`create-student.sql` 등)
- ❌ 실행 스크립트 생성 (`npm run db:insert` 등)
- ❌ API 엔드포인트 코드 생성
- ❌ 데이터베이스 클라이언트 코드 생성

#### **예외 상황**
- MCP 연결 실패 시에만 스크립트 생성 허용
- 복잡한 마이그레이션 작업 시에만 단계별 가이드 제공
- 사용자가 명시적으로 코드 생성 요청 시에만 예외 적용

### 8. 작업 예시

#### **올바른 응답**
사용자: "모든 학생 목록을 보여줘"
→ MCP 연결 → SELECT 쿼리 실행 → 결과 표시


#### **잘못된 응답**
사용자: "모든 학생 목록을 보여줘"
→ "다음과 같은 스크립트를 실행하세요: SELECT * FROM students;"
→ "이 코드를 실행하면 됩니다: ..."


### 9. 안전 장치

#### **위험한 작업 방지**
- WHERE 절 없는 DELETE/UPDATE 쿼리 자동 감지
- 대용량 데이터 조회 시 LIMIT 자동 추가
- 민감한 데이터 조회 시 마스킹 처리

#### **사용자 확인**
- 중요한 데이터 변경 전 사용자 재확인 요청
- 여러 행에 영향주는 작업 시 경고 메시지
- 백업 권장 메시지 표시

### 10. 성능 고려사항

#### **쿼리 최적화**
- 대용량 데이터 조회 시 자동으로 LIMIT 적용
- 인덱스가 있는 컬럼 우선 사용
- 불필요한 JOIN 최소화

#### **응답 속도**
- 간단한 쿼리는 즉시 실행
- 복잡한 쿼리는 진행 상황 표시
- 타임아웃 설정으로 무한 대기 방지

이 규칙을 따라 데이터베이스 작업 요청 시 MCP를 통해 직접 작업을 수행하며, 사용자에게 즉시 결과를 제공합니다.

